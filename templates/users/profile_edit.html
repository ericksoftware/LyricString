{% extends "base.html" %}

{% load static %}

{% block title %}Edit Profile - LyricString{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile_edit.css' %}">
{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-user-edit"></i> Edit Profile</h1>
    <p>Update your profile information and preferences</p>
</div>

<div class="edit-container">
    <form method="post" enctype="multipart/form-data">
        <!-- Profile Picture Section -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-camera"></i> Profile Picture
            </h2>
            
            <div class="avatar-section">
                <div class="current-avatar">
                    <i class="fas fa-user"></i>
                    <div class="avatar-overlay">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                
                <div class="file-input-wrapper">
                    <input type="file" id="avatar" name="avatar" class="file-input" accept="image/*">
                    <label for="avatar" class="file-input-label">
                        <i class="fas fa-upload"></i> Change Picture
                    </label>
                </div>
                <div class="form-group">
                <label for="bio" class="form-label">Bio</label>
                <textarea id="bio" name="bio" class="form-input form-textarea" placeholder="Tell us about yourself and your musical journey...">Music enthusiast and aspiring guitarist. Love exploring different genres and sharing my musical journey with the community.</textarea>
                <div class="form-help">Maximum 500 characters</div>
            </div>
        </div>

        <!-- Musical Preferences -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-music"></i> Musical Preferences
            </h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="favorite_genre" class="form-label">Favorite Genre</label>
                    <select id="favorite_genre" name="favorite_genre" class="form-select">
                        <option value="">Select your favorite genre</option>
                        <option value="rock" selected>Rock</option>
                        <option value="pop">Pop</option>
                        <option value="jazz">Jazz</option>
                        <option value="classical">Classical</option>
                        <option value="electronic">Electronic</option>
                        <option value="folk">Folk</option>
                        <option value="reggae">Reggae</option>
                        <option value="blues">Blues</option>
                        <option value="country">Country</option>
                        <option value="hip-hop">Hip-Hop</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="skill_level" class="form-label">Skill Level</label>
                    <select id="skill_level" name="skill_level" class="form-select">
                        <option value="beginner">Beginner</option>
                        <option value="intermediate" selected>Intermediate</option>
                        <option value="advanced">Advanced</option>
                        <option value="professional">Professional</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Instruments You Play</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="guitar" name="instruments" value="guitar" checked>
                        <label for="guitar">Guitar</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="piano" name="instruments" value="piano">
                        <label for="piano">Piano</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="drums" name="instruments" value="drums" checked>
                        <label for="drums">Drums</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="bass" name="instruments" value="bass">
                        <label for="bass">Bass</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="violin" name="instruments" value="violin">
                        <label for="violin">Violin</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="vocals" name="instruments" value="vocals">
                        <label for="vocals">Vocals</label>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Music Genres You Enjoy</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="genre_rock" name="genres" value="rock" checked>
                        <label for="genre_rock">Rock</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="genre_pop" name="genres" value="pop" checked>
                        <label for="genre_pop">Pop</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="genre_jazz" name="genres" value="jazz">
                        <label for="genre_jazz">Jazz</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="genre_classical" name="genres" value="classical">
                        <label for="genre_classical">Classical</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="genre_electronic" name="genres" value="electronic" checked>
                        <label for="genre_electronic">Electronic</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="genre_folk" name="genres" value="folk">
                        <label for="genre_folk">Folk</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Location & Contact -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-map-marker-alt"></i> Location & Contact
            </h2>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="country" class="form-label">Country</label>
                    <select id="country" name="country" class="form-select">
                        <option value="">Select your country</option>
                        <option value="us">United States</option>
                        <option value="ca">Canada</option>
                        <option value="uk">United Kingdom</option>
                        <option value="au">Australia</option>
                        <option value="de">Germany</option>
                        <option value="fr">France</option>
                        <option value="es">Spain</option>
                        <option value="it">Italy</option>
                        <option value="mx" selected>Mexico</option>
                        <option value="br">Brazil</option>
                        <option value="ar">Argentina</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="city" class="form-label">City</label>
                    <input type="text" id="city" name="city" class="form-input" value="Tijuana" placeholder="Enter your city">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="website" class="form-label">Website/Portfolio</label>
                    <input type="url" id="website" name="website" class="form-input" placeholder="https://yourwebsite.com">
                </div>
                
                <div class="form-group">
                    <label for="social_media" class="form-label">Social Media</label>
                    <input type="text" id="social_media" name="social_media" class="form-input" placeholder="@yourusername">
                </div>
            </div>
        </div>

        <!-- Privacy Settings -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-shield-alt"></i> Privacy Settings
            </h2>
            
            <div class="privacy-section">
                <div class="privacy-title">
                    <i class="fas fa-eye"></i> Profile Visibility
                </div>
                
                <div class="switch-group">
                    <span class="switch-label">Make profile public</span>
                    <label class="switch">
                        <input type="checkbox" name="public_profile" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="switch-group">
                    <span class="switch-label">Show liked songs</span>
                    <label class="switch">
                        <input type="checkbox" name="show_liked_songs" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="switch-group">
                    <span class="switch-label">Show activity feed</span>
                    <label class="switch">
                        <input type="checkbox" name="show_activity">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="switch-group">
                    <span class="switch-label">Allow others to find me by email</span>
                    <label class="switch">
                        <input type="checkbox" name="findable_by_email">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Notifications -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-bell"></i> Notification Preferences
            </h2>
            
            <div class="switch-group">
                <span class="switch-label">Email notifications for new followers</span>
                <label class="switch">
                    <input type="checkbox" name="notify_followers" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="switch-group">
                <span class="switch-label">Email notifications for song recommendations</span>
                <label class="switch">
                    <input type="checkbox" name="notify_recommendations" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="switch-group">
                <span class="switch-label">Weekly music digest</span>
                <label class="switch">
                    <input type="checkbox" name="weekly_digest" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="switch-group">
                <span class="switch-label">Push notifications on mobile</span>
                <label class="switch">
                    <input type="checkbox" name="push_notifications">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- Account Settings -->
        <div class="form-section">
            <h2 class="section-title">
                <i class="fas fa-cog"></i> Account Settings
            </h2>
            
            <div class="form-group">
                <label for="current_password" class="form-label">Current Password</label>
                <input type="password" id="current_password" name="current_password" class="form-input" placeholder="Enter current password to save changes">
                <div class="form-help">Required to save profile changes</div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="new_password" class="form-label">New Password (Optional)</label>
                    <input type="password" id="new_password" name="new_password" class="form-input" placeholder="Leave blank to keep current password">
                </div>
                
                <div class="form-group">
                    <label for="confirm_password" class="form-label">Confirm New Password</label>
                    <input type="password" id="confirm_password" name="confirm_password" class="form-input" placeholder="Confirm new password">
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Changes
            </button>
            <a href="/profile/" class="btn btn-outline">
                <i class="fas fa-times"></i> Cancel
            </a>
            <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                <i class="fas fa-trash"></i> Delete Account
            </button>
        </div>
    </form>
</div>

<script>
    // File input preview
    document.getElementById('avatar').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatar = document.querySelector('.current-avatar');
                avatar.style.backgroundImage = `url(${e.target.result})`;
                avatar.style.backgroundSize = 'cover';
                avatar.style.backgroundPosition = 'center';
                avatar.innerHTML = '';
            };
            reader.readAsDataURL(file);
        }
    });

    // Password confirmation validation
    document.getElementById('confirm_password').addEventListener('input', function() {
        const newPassword = document.getElementById('new_password').value;
        const confirmPassword = this.value;
        
        if (newPassword && confirmPassword && newPassword !== confirmPassword) {
            this.style.borderColor = '#e74c3c';
        } else {
            this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
        }
    });

    // Character counter for bio
    document.getElementById('bio').addEventListener('input', function() {
        const maxLength = 500;
        const currentLength = this.value.length;
        const helpText = this.nextElementSibling;
        
        if (currentLength > maxLength) {
            this.style.borderColor = '#e74c3c';
            helpText.style.color = '#e74c3c';
            helpText.textContent = `${currentLength}/${maxLength} characters (${currentLength - maxLength} over limit)`;
        } else {
            this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
            helpText.style.color = '#888';
            helpText.textContent = `${currentLength}/${maxLength} characters`;
        }
    });

    // Delete account confirmation
    function confirmDelete() {
        if (confirm('Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently lost.')) {
            if (confirm('This is your final warning. Are you absolutely sure you want to delete your account?')) {
                // Here you would redirect to delete account endpoint
                alert('Account deletion functionality would be implemented here.');
            }
        }
    }

    // Form validation before submit
    document.querySelector('form').addEventListener('submit', function(e) {
        const currentPassword = document.getElementById('current_password').value;
        const newPassword = document.getElementById('new_password').value;
        const confirmPassword = document.getElementById('confirm_password').value;
        
        if (!currentPassword) {
            e.preventDefault();
            alert('Please enter your current password to save changes.');
            return;
        }
        
        if (newPassword && newPassword !== confirmPassword) {
            e.preventDefault();
            alert('New passwords do not match.');
            return;
        }
        
        if (newPassword && newPassword.length < 8) {
            e.preventDefault();
            alert('New password must be at least 8 characters long.');
            return;
        }
    });

    // Smooth animations for form interactions
    document.querySelectorAll('.form-input, .form-select').forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.style.transform = 'translateY(-2px)';
        });
        
        input.addEventListener('blur', function() {
            this.parentElement.style.transform = 'translateY(0)';
        });
    });
</script>
{% endblock %}
