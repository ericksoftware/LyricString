{% extends "base.html" %}

{% load static %}

{% block title %}Admin Dashboard - LyricString{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="admin-container">
    <!-- Header -->
    <div class="admin-header">
        <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
        <p>Welcome back, {{ request.user.get_full_name|default:request.user.username }}</p>
    </div>

    <!-- Stats Overview -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon users">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_users }}</h3>
                <p>Total Users</p>
                <span class="stat-change">+{{ new_users_today }} today</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon active">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="stat-content">
                <h3>{{ active_users }}</h3>
                <p>Active Users</p>
                <span class="stat-change">{{ active_users|floatformat:0 }}% active</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon songs">
                <i class="fas fa-music"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_songs }}</h3>
                <p>Total Songs</p>
                <span class="stat-change">{{ recent_songs|length }} new</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon content">
                <i class="fas fa-database"></i>
            </div>
            <div class="stat-content">
                <h3>{{ total_artists }}</h3>
                <p>Artists</p>
                <span class="stat-change">{{ total_genres }} genres</span>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="dashboard-grid">
        <!-- User Growth Chart -->
        <div class="chart-card">
            <div class="card-header">
                <h3><i class="fas fa-chart-line"></i> User Growth (Last 7 Days)</h3>
            </div>
            <div class="chart-container">
                <canvas id="userGrowthChart"></canvas>
            </div>
        </div>

        <!-- Recent Users -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-user-plus"></i> Recent Signups</h3>
            </div>
            <div class="card-content">
                {% for user in recent_users %}
                <div class="list-item">
                    <div class="user-avatar">
                        {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="{{ user.username }}">
                        {% else %}
                        <i class="fas fa-user"></i>
                        {% endif %}
                    </div>
                    <div class="user-info">
                        <strong>{{ user.get_full_name|default:user.username }}</strong>
                        <span>@{{ user.username }}</span>
                    </div>
                    <div class="user-meta">
                        {{ user.date_joined|timesince }} ago
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Songs -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-music"></i> Recent Songs</h3>
            </div>
            <div class="card-content">
                {% for song in recent_songs %}
                <div class="list-item">
                    <div class="song-cover">
                        {% if song.cover_image %}
                        <img src="{{ song.cover_image.url }}" alt="{{ song.title }}">
                        {% else %}
                        <i class="fas fa-music"></i>
                        {% endif %}
                    </div>
                    <div class="song-info">
                        <strong>{{ song.title }}</strong>
                        <span>{{ song.artist.name }}</span>
                    </div>
                    <div class="song-meta">
                        {{ song.created_at|timesince }} ago
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Popular Genres -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-chart-pie"></i> Popular Genres</h3>
            </div>
            <div class="card-content">
                {% for genre in popular_genres %}
                <div class="genre-item">
                    <div class="genre-info">
                        <strong>{{ genre.name }}</strong>
                        <span>{{ genre.song_count }} songs</span>
                    </div>
                    <div class="genre-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: {{ genre.song_count|divisibleby:total_songs|default:0|floatformat:2 }}%"></div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            </div>
            <div class="card-content">
                <div class="action-grid">
                    <a href="/admin/content/song/add/" class="action-btn">
                        <i class="fas fa-plus"></i>
                        <span>Add Song</span>
                    </a>
                    <a href="/admin/content/artist/add/" class="action-btn">
                        <i class="fas fa-user-plus"></i>
                        <span>Add Artist</span>
                    </a>
                    <a href="/admin/users/customuser/" class="action-btn">
                        <i class="fas fa-users"></i>
                        <span>Manage Users</span>
                    </a>
                    <a href="/admin/content/genre/add/" class="action-btn">
                        <i class="fas fa-tag"></i>
                        <span>Add Genre</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-server"></i> System Status</h3>
            </div>
            <div class="card-content">
                <div class="status-item">
                    <span class="status-label">Database</span>
                    <span class="status-value online">Online</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Media Files</span>
                    <span class="status-value online">Online</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Cache</span>
                    <span class="status-value warning">Limited</span>
                </div>
                <div class="status-item">
                    <span class="status-label">Uptime</span>
                    <span class="status-value">24/7</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js for graphs -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // User Growth Chart
    document.addEventListener('DOMContentLoaded', function() {
        const ctx = document.getElementById('userGrowthChart').getContext('2d');
        const userGrowthData = {{ user_growth|safe }};
        
        const chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: userGrowthData.map(item => item.date),
                datasets: [{
                    label: 'New Users',
                    data: userGrowthData.map(item => item.count),
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                }
            }
        });
    });
</script>
{% endblock %}